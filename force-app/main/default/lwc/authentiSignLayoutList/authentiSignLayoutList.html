<template>
    <lightning-card variant="base" title="Authentisign Layout">
        <div slot="actions">
            <lightning-button-icon
                icon-name="utility:add"
                variant="bare"
                alternative-text="Create New Template"
                title="Create New Template"
                onclick={handleCreateTemplateClick}
            ></lightning-button-icon>
        </div>
        <div class="slds-p-around_medium">
            <template if:true={spinner}>
                <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
            </template>

            <lightning-radio-group
                name="layoutType"
                label="Select Type"
                options={radioOptions}
                value={selectedOption}
                type="radio"
                onchange={handleChangeRadio}
            ></lightning-radio-group>

            <template if:true={isDocumentSelected}>
                <lightning-combobox
                    name="document"
                    label="Document"
                    placeholder="Select Document"
                    value={selectedDocument}
                    options={documents}
                    onchange={handleChangeDocument}
                    disabled={isDocumentDisabled}
                ></lightning-combobox>

                <div class="slds-m-top_small">
                    <template if:true={selectedDocument}>
                        <p>Document Signing Status: {documentSigningStatus}</p>
                        <template if:false={isDocumentSigned}>
                            <lightning-button
                                variant="brand"
                                label="Select Signers"
                                onclick={navigateToSigners}
                                class={btnStartDocumentClass}
                            ></lightning-button>
                        </template>
                        <template if:true={isDocumentSigned}>
                            <lightning-button
                                variant="brand"
                                label="Download PDF"
                                onclick={displayPdfDocument}
                            ></lightning-button>
                        </template>
                    </template>
                </div>
            </template>

            <template if:false={isDocumentSelected}>
                <lightning-combobox
                    name="layout"
                    label="Layout"
                    placeholder="Select Layout"
                    value={selectedRecord}
                    options={layouts}
                    onchange={handleLayoutChange}
                ></lightning-combobox>

                <div class="slds-m-top_small">
                    <template if:true={selectedRecord}>
                        <p>Layout Signing Status: {signingStatus}</p>
                        <template if:false={isLayoutSigned}>
                            <lightning-button
                                variant="brand"
                                label="Configure Layout"
                                onclick={navigateToMappings}
                                class={btnStartClass}
                            ></lightning-button>
                        </template>
                        <template if:true={isLayoutSigned}>
                            <lightning-button
                                variant="brand"
                                label="Download PDF"
                                onclick={displayPdf}
                            ></lightning-button>
                        </template>
                    </template>
                </div>
            </template>
        </div>
    </lightning-card>

    <div class={modalClass}>
        <div class="slds-modal__container">
            <div class="slds-modal__header">
                <lightning-button-icon
                    icon-name="utility:close"
                    variant="bare"
                    onclick={handleCloseModal}
                    alternative-text="Close"
                    class="slds-modal__close"
                ></lightning-button-icon>
                <h2 class="slds-modal__title">Create New Template</h2>
            </div>
            <div class="slds-modal__content slds-p-around_medium">
                <template if:false={layoutId}>
                    <lightning-input
                        type="text"
                        label="Template Name"
                        value={templateName}
                        onchange={handleTemplateNameChange}
                        required
                    ></lightning-input>
                </template>
                <template if:true={layoutId}>
                    <div class="slds-m-top_medium">
                        <p>
                            <b>Template Name:</b>&nbsp;&nbsp;
                            <span class="slds-text-color_success">{templateName}</span>
                        </p>
                        <p>
                            <b>Layout ID:</b>&nbsp;&nbsp;
                            <span class="slds-text-color_success">{layoutId}</span>
                            <lightning-icon icon-name="utility:check" size="small" class="slds-m-left_xx-small" variant="success"></lightning-icon>
                        </p>
                    </div>
                    <lightning-button
                        variant="brand"
                        label="Launch SSO"
                        icon-name="utility:open"
                        icon-position="left"
                        onclick={handleLaunchSSO}
                        class="slds-m-top_small"
                    ></lightning-button>
                </template>
                <template if:true={error}>
                    <div class="slds-text-color_error slds-m-top_small">{error}</div>
                    <lightning-button
                        variant="brand"
                        label="Retry"
                        onclick={handleSubmitTemplate}
                        class="slds-m-top_small"
                    ></lightning-button>
                </template>
            </div>
            <div class="slds-modal__footer" if:false={layoutId}>
                <lightning-button
                    variant="neutral"
                    label="Cancel"
                    onclick={handleCloseModal}
                ></lightning-button>
                <lightning-button
                    variant="brand"
                    label="Submit"
                    onclick={handleSubmitTemplate}
                    disabled={isSubmitDisabled}
                ></lightning-button>
            </div>
        </div>
    </div>
    <div class={backdropClass}></div>
</template>
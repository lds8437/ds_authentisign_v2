<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" 
                access="global" controller="AuthentiSignMappingCtrl" >
    <aura:html tag="style">.toastMessage.forceActionsText{white-space : pre-line !important;}</aura:html>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    
    <!--Fields sent from parent control-->
    <aura:attribute name="layouts" type="List" />
    <aura:attribute name="quoteId" type="string" />
    <aura:attribute name="layoutId" type="string" />
    <aura:attribute name="mappings" type="string" />
    <aura:attribute name="objectName" type="string" />
    
    <!--Fields manuplated from parent fields-->
    <aura:attribute name="fields" type="List" />
    <aura:attribute name="fieldsMap" type="List" />
    <aura:attribute name="selectedLayout" type="object" />

    <!--Data returned from controller which includes records of Quote and Quote line items , field description for Quote and Quote line items and participients list-->
	<aura:attribute name="allData" type="object" />
    
	<!--Lists to populate dropdowns-->
    <aura:attribute name="quoteFields" type="List" />
    <aura:attribute name="quoteLineItemFields" type="List" />
    <aura:attribute name="lineItemRecords" type="List" />
    <aura:attribute name="roles" type="List" />
    <aura:attribute name="usercontactfields" type="List" />
    
    <!--Fields to store line item id and line item field-->
    <aura:attribute name="lineItemId" type="string" />
    <aura:attribute name="lineItemField" type="string"  />
    
	<!--Participients list-->
    <aura:attribute name="participients" type="List" />

    <aura:attribute name="expirationDate" type="string"  />
    <aura:attribute name="spinner" type="boolean" default="false"/>
     
    <!--loading spinner start-->
    <aura:if isTrue="{!v.spinner}">
        <div aura:id="spinnerId" class="slds-spinner_container">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                <span class="slds-assistive-text">Loading...</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:if>
    
    <lightning:card variant="base" title="Layout Mapping">
        <aura:set attribute="actions">
             <button aura:id="btnBack" class="slds-button slds-button_brand"  onclick="{!c.back}" >Back</button>
        </aura:set>
        <p class="slds-p-horizontal_small">

            <div class="slds-grid slds-wrap" >
                <div class="slds-col slds-size_2-of-12" ></div>
                <div class="slds-col slds-size_3-of-12" >
                    <h1 id="element-with-table-label" class="slds-text-heading_medium slds-m-bottom_xx-small slds-size_4-of-8">Layout</h1>
                    <h3 id="element-with-table-label" class="slds-text-heading_small slds-m-bottom_xx-small slds-size_4-of-8">{!v.selectedLayout.name}</h3>
                </div>
                <div class="slds-col slds-size_4-of-12" >
                    <h1 id="element-with-table-label" class="slds-text-heading_medium slds-m-bottom_xx-small slds-size_4-of-8">Quote</h1>
                    <h3 id="element-with-table-label" class="slds-text-heading_small slds-m-bottom_xx-small slds-size_4-of-8">{!v.allData.quote.Name}</h3>
                </div>
                <div class="slds-col slds-size_3-of-12" >
                    <h1 id="element-with-table-label" class="slds-text-heading_medium slds-m-bottom_xx-small slds-size_4-of-8">Expiration Date</h1>
                    <h3 id="element-with-table-label" class="slds-text-heading_small slds-m-bottom_xx-small slds-size_4-of-8">{!v.expirationDate}</h3>
                </div>
            </div>
            <br/>
            <br/>
            <div class="slds-grid slds-wrap" >
                <div class="slds-col slds-size_2-of-12" ></div>
                <div class="slds-col slds-size_8-of-12" >
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Opportunity Name">AuthentiSign Fields</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Quote Line Items">Map to<br/>Quote Line Item</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Account Name">Salesforce Fields</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Value">Value</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.fields}" var="record" indexVar="index"> 
                                <tr class="slds-hint-parent">
                                    <td data-label="Active Pipe Field">
                                        <div class="slds-truncate"  aura:id="AuthFieldValue" title="AuthentiSign Field">{!record}</div>
                                    </td>
                                    <td data-label="Checkbox">
                                        <lightning:input type="checkbox" aura:id="chkQuoteLI" title="{!record}"  name="{!'chkQuoteLI-'+index}" onchange="{!c.chkQuoteLIChange}"/>
                                    </td>
                                    <td data-label="Salesforce Field">
                                        
                                        <!--Quote Fields Dropdown-->
                                        <lightning:select  aura:id="ddlQuoteFields" name="{!'ddlSFQuoteField-'+index}" title="{!record}" label="Quote Fields" onchange="{!c.handleChangeQuoteddl}" >
                                            <aura:iteration items="{!v.quoteFields}" var="qrec" >
                                                <option text="{!qrec.name}" value="{!qrec.value}" ></option>
                                            </aura:iteration>
                                        </lightning:select>
                                        
                                        <!--Line Item Records Dropdown-->
                                        <lightning:select  aura:id="ddlLineItems" name="{!'ddlLineItems-'+index}" title="{!record}" label="Quote Line Item Records" onchange="{!c.handleChangeQuoteLineItemddl}" class="slds-hide" >
                                            <aura:iteration items="{!v.lineItemRecords}" var="lirec" >
                                                <option text="{!lirec.name}" value="{!lirec.value}" ></option>
                                            </aura:iteration>
                                        </lightning:select>
                                        
                                        <!--Line Item Fields Dropdown-->
                                        <lightning:select  aura:id="ddlQuoteLineItemFields" name="{!'ddlSFQuoteLineItemField-'+index}" title="{!record}" label="Quote Line Item Fields" onchange="{!c.handleChangeQuoteLineItemddl}" class="slds-hide" >
                                            <aura:iteration items="{!v.quoteLineItemFields}" var="qirec" >
                                                <option text="{!qirec.name}" value="{!qirec.value}" ></option>
                                            </aura:iteration>
                                        </lightning:select>
                                    </td>
                                    <td data-label="Active Pipe Field">
                                        <lightning:input type="text"  aura:id="txtquotefieldvalue" name="{!'txtquotefieldvalue-'+index}" label="" disabled="true" />
                                    </td>
                                </tr>
                            </aura:iteration>
                        </tbody>
                    </table>
                </div>
                <div class="slds-col slds-size_2-of-12" ></div>
            </div>
            <br/>
            <br/>
            <div class="slds-grid slds-wrap" >
                <div class="slds-col slds-size_2-of-12" ></div>
                <div class="slds-col slds-size_8-of-12" >
                    <h2 id="element-with-table-label" class="slds-text-heading_medium slds-m-bottom_xx-small slds-size_4-of-8">Participants</h2>
                </div>
            </div>
            <div class="slds-grid slds-wrap" >
                
                <div class="slds-col slds-size_2-of-12" ></div>
                <div class="slds-col slds-size_8-of-12" >
                    <!--New Table logic-->
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Role">Role</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Type">User/Contact</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Name">Name</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Email">Email</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Type">Type</div>
                                </th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.roles}" var="record" indexVar="index"> 
                                <tr class="slds-hint-parent">
                                    <td data-label="SObject">
                                        <div class="slds-truncate" title="{!record.name}">{!record.name}</div>
                                    </td>
                                    <td data-label="Roles">
                                        <lightning:select  aura:id="ddlUserContact" name="{!'ddlUserContact-'+index}" title="{!record.name}"  label="" onchange="{!c.handleUserContactddl}" >
                                            <aura:iteration items="{!v.usercontactfields}" var="fld" >
                                                <option text="{!fld.name}" value="{!fld.value}"></option>
                                            </aura:iteration>
                                        </lightning:select>
                                    </td>
                                    <td data-label="Name">
                                        <div class="slds-truncate" title="">{!record.data.Name}</div>
                                    </td>
                                    <td data-label="Email">
                                        <div class="slds-truncate" title="">{!record.data.Email}</div>
                                    </td>
                                    <td data-label="Phone">
                                        <div class="slds-truncate" title="">{!record.data.Type}</div>
                                    </td>
                                </tr>
                            </aura:iteration>
                        </tbody>
                    </table>
                    <!--Old Table logic, it is hidden-->
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-hide" aria-labelledby="element-with-table-label other-element-with-table-label">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Type">Type</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Role">Role</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Name">Name</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Email">Email</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Phone">Phone</div>
                                </th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.participients}" var="record" indexVar="index"> 
                                <tr class="slds-hint-parent">
                                    <td data-label="SObject">
                                        <div class="slds-truncate" title="{!record.Object}">{!record.Object}</div>
                                    </td>
                                    <td data-label="Roles">
                                        <lightning:select  aura:id="ddlRoles" name="{!'ddlRoles-'+index}"  label="" onchange="{!c.handleChangeRolesddl}" >
                                            <aura:iteration items="{!v.roles}" var="role" >
                                                <option text="{!role.name}" value="{!role.value}"></option>
                                            </aura:iteration>
                                        </lightning:select>
                                    </td>
                                    <td data-label="Name">
                                        <div class="slds-truncate" title="">{!record.Name}</div>
                                    </td>
                                    <td data-label="Email">
                                        <div class="slds-truncate" title="{!record.Name}">{!record.Email}</div>
                                    </td>
                                    <td data-label="Phone">
                                        <div class="slds-truncate" title="{!record.Phone}">{!record.Phone}</div>
                                    </td>
                                </tr>
                            </aura:iteration>
                        </tbody>
                    </table>
                </div>
                <div class="slds-col slds-size_2-of-12" ></div>
            </div>
            <br/>
            <br/>
            <div class="slds-grid slds-wrap" >
                
                <div class="slds-col slds-size_2-of-12" ></div>
                <div class="slds-col slds-size_8-of-12" >
                    <button aura:id="btnSubmit" class="slds-button slds-button_brand"  onclick="{!c.createRequest}" >Fill and Send</button>
                </div>
                <div class="slds-col slds-size_2-of-12" ></div>
            </div>
            <br/>
            <br/>
        </p>
    </lightning:card>
</aura:component>